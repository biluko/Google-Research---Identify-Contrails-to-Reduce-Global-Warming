比赛的任务是预测飞机尾迹的形成区域，这些尾迹在卫星图像中表现为长度至少是宽度的3倍的轨迹。我们需要使用卫星图像来验证预测模型的准确性。比赛提供的数据包括训练集和测试集，每个数据集都包含多个记录，每个记录包含多个.npy文件，这些文件包含了不同波长的红外通道的亮度温度信息。训练集还包含了人工标注的尾迹信息。

1. 数据处理
在数据处理阶段，我们首先定义了一个函数read_record(directory)，这个函数用于读取数据记录，这些数据记录可能是图像或者其他类型的数据。然后，使用get_false_color(record_data)函数获取虚假颜色图像（false color image），这是一种预处理的图像，可以帮助提高模型的性能。

然后，我们遍历训练集的每个记录，对每个记录的数据进行处理，并保存处理后的图像和标签。最后，我们使用5折交叉验证来划分数据集，生成训练集和验证集。

我们只挑选了图片中包含正类的图片作为训练集。

2. 模型训练
在模型训练阶段，我们使用了MMsegmentation库来训练模型。MMsegmentation是一个开源的语义分割工具箱，它提供了丰富的模型库和训练配置。

我们选择了UPerNet作为我们的模型，它是一个全卷积网络，可以进行端到端的训练和推理。我们使用了ConvNeXt作为模型的骨干网络，它是一种新的卷积网络结构，可以提供更好的性能。

最终的方案中，我们使用了如下两个模型

upernet + convnext-base

upernet + convnext-large

我们为模型定义了训练配置，包括学习率策略、优化器、损失函数等。我们使用了交叉熵损失函数，并设置了类别权重来处理类别不平衡问题。我们还使用了AdamW优化器，并设置了学习率衰减策略。

## 损失函数：CrossEntropyLoss + 10倍的正类class_weight
## 优化器：AdamW
## 学习率：2.5e-4

然后，我们使用MMsegmentation提供的训练函数来训练模型。在训练过程中，我们保存了每个epoch的模型参数，并在验证集上评估了模型的性能。

3. 模型推理

在模型推理阶段，我们首先加载了训练好的模型参数。然后，我们遍历测试集的每个记录，对每个记录的数据进行处理，并使用模型进行预测。

我们使用了多个模型进行预测，并将各个模型的预测结果进行了平均，以提高预测的稳定性。我们设置了一个阈值0.75，将预测结果大于阈值的像素标记为尾迹。

最后，我们使用RLE编码对预测的尾迹进行编码，并将编码结果保存到提交文件中。

## 总结
在由Google Research主办的全球卫星图像中飞机尾迹识别竞赛中，我们团队设计并实施了一套完整的解决方案。首先，在数据预处理阶段，我们团队采用自定义函数提取红外通道亮度温度信息并生成虚假颜色图像，提高模型的感知能力。考虑到类别不平衡问题，仅选择包含正类的图片进行训练，并采用5折交叉验证来优化数据集划分。模型方面，通过MMsegmentation库，选择了UPerNet作为基础框架，并采用ConvNeXt的两种配置进行集成。考虑到分类权重，使用了交叉熵损失函数并加权正类，同时引入AdamW优化器，并设置学习率为2.5e-4。在模型推理阶段，融合多模型预测，设定了0.75的阈值进行尾迹判定，并采用RLE编码进行结果提交，为项目提供了稳健、高效的输出方案。最终取得 Dice coefficient 0.69x 的得分，排名前x%
